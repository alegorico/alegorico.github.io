/*! @chrisdiana/cmsjs v2.0.1 | MIT (c) 2025 Chris Diana | https://github.com/chrisdiana/cms.js */
var CMS=function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t,i){return t&&function(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var i,r={elementId:null,layoutDirectory:null,defaultView:null,errorLayout:null,mode:"SERVER",github:null,types:[],plugins:[],frontMatterSeperator:/^---$/m,listAttributes:["tags"],dateParser:/\d{4}-\d{2}(?:-\d{2})?/,dateFormat:function(e){return[e.getMonth()+1,e.getDate(),e.getFullYear()].join("/")},extension:".md",sort:void 0,markdownEngine:null,debug:!1,messageClassName:"cms-messages",onload:function(){},onroute:function(){}},o='ERROR: No element ID or ID incorrect. Check "elementId" parameter in config.',s="ERROR: Error getting files. Make sure there is a directory for each type in config with files in it.",a="ERROR: Error getting the file",l="ERROR: Error loading layout. Check the layout file to make sure it exists.",c="WARNING: Not ready to perform action";function u(e,t){return e&&(i.innerHTML=t),t}function h(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?t(n.response,!1):t(n,n.statusText))},n.send()}function f(e,t){t||(t=window.location.href),e=e.replace(/[[]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function g(e){var t=new Date(e);return new Date(t.getTime()- -6e4*t.getTimezoneOffset())}function p(e,t,n){h(e,function(e,i){var r;i&&n(e,i),n((r=e,new Function("data","var output="+JSON.stringify(r).replace(/<%=(.+?)%>/g,'"+($1)+"').replace(/<%(.+?)%>/g,'";$1\noutput+="')+";return output;"))(t),i)})}function m(e,t,n){t.container.innerHTML="",p([t.layoutDirectory,"/",e,".html"].join(""),n,function(e,n){n?u(l):t.container.innerHTML=e})}var d=function(){return t(function t(){e(this,t),this.rules=[{regex:/(#+)(.*)/g,replacement:function(e,t,n){var i=t.length;return"<h"+i+">"+n.trim()+"</h"+i+">"}},{regex:/!\[([^[]+)\]\(([^)]+)\)/g,replacement:"<img src='$2' alt='$1'>"},{regex:/\[([^[]+)\]\(([^)]+)\)/g,replacement:"<a href='$2'>$1</a>"},{regex:/(\*\*|__)(.*?)\1/g,replacement:"<strong>$2</strong>"},{regex:/(\*|_)(.*?)\1/g,replacement:"<em>$2</em>"},{regex:/~~(.*?)~~/g,replacement:"<del>$1</del>"},{regex:/:"(.*?)":/g,replacement:"<q>$1</q>"},{regex:/```[a-z]*\n[\s\S]*?\n```/g,replacement:function(e){return"<pre>"+(e=e.replace(/```/gm,"")).trim()+"</pre>"}},{regex:/&&&[a-z]*\n[\s\S]*?\n&&&/g,replacement:function(e){return'<script type="text/javascript">'+(e=e.replace(/```/gm,"")).trim()+"<\/script>"}},{regex:/`(.*?)`/g,replacement:"<code>$1</code>"},{regex:/\n\*(.*)/g,replacement:function(e,t){return"\n<ul>\n\t<li>"+t.trim()+"</li>\n</ul>"}},{regex:/\n[0-9]+\.(.*)/g,replacement:function(e,t){return"\n<ol>\n\t<li>"+t.trim()+"</li>\n</ol>"}},{regex:/\n(&gt;|>)(.*)/g,replacement:function(e,t,n){return"\n<blockquote>"+n.trim()+"</blockquote>"}},{regex:/\n-{5,}/g,replacement:"\n<hr />"},{regex:/\n([^\n]+)\n/g,replacement:function(e,t){var n=t.trim();return/^<\/?(ul|ol|li|h|p|bl)/i.test(n)?"\n"+t+"\n":"\n<p>"+n+"</p>\n"}},{regex:/<\/ul>\s?<ul>/g,replacement:""},{regex:/<\/ol>\s?<ol>/g,replacement:""},{regex:/<\/blockquote><blockquote>/g,replacement:"\n"}]},[{key:"render",value:function(e){return e="\n"+e+"\n",this.rules.forEach(function(t){e=e.replace(t.regex,t.replacement)}),e.trim()}}])}(),y=function(){return t(function t(n,i,r,o){e(this,t),this.url="SERVER"===i?i+"/"+n:n,this.type=i,this.layout=r,this.config=o,this.html=!1,this.content,this.name,this.extension,this.title,this.excerpt,this.date,this.datetime,this.author,this.body,this.permalink,this.tags},[{key:"getContent",value:function(e){var t=this;h(this.url,function(n,i){i&&e(n,i),t.content=n,"string"==typeof t.content&&e(n,i)})}},{key:"parseFrontMatter",value:function(){var e=this.content.split(this.config.frontMatterSeperator)[1];if(e){var t={};e.split(/\n/g).forEach(function(e){var n=e.split(":");n[1]&&(t[n[0].trim()]=n[1].trim())}),function(e,t){var n;for(n in void 0===t&&(t=e),t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}(this,t)}}},{key:"setListAttributes",value:function(){var e=this;this.config.listAttributes.forEach(function(t){Object.prototype.hasOwnProperty.call(e,t)&&e[t]&&(e[t]=e[t].split(",").map(function(e){return e.trim()}))})}},{key:"setFilename",value:function(){this.name=this.url.substr(this.url.lastIndexOf("/")).replace("/","").replace(this.config.extension,"")}},{key:"setPermalink",value:function(){this.permalink=["#",this.type,this.name].join("/")}},{key:"setDate",value:function(){var e=new RegExp(this.config.dateParser);this.date?(this.datetime=g(this.date),this.date=this.config.dateFormat(this.datetime)):e.test(this.url)&&(this.date=e.exec(this.url),this.datetime=g(this.date),this.date=this.config.dateFormat(this.datetime))}},{key:"setBody",value:function(){var e=this.content.split(this.config.frontMatterSeperator).splice(2).join(this.config.frontMatterSeperator);if(this.html)this.body=e;else if(this.config.markdownEngine)this.body=this.config.markdownEngine(e);else{var t=new d;this.body=t.render(e)}}},{key:"parseContent",value:function(){this.setFilename(),this.setPermalink(),this.parseFrontMatter(),this.setListAttributes(),this.setDate(),this.setBody()}},{key:"render",value:function(){return m(this.layout,this.config,this)}}])}(),v=function(){return t(function t(n,i,r){e(this,t),this.type=n,this.layout=i,this.config=r,this.files=[],this[n]=this.files},[{key:"init",value:function(e){var t=this;this.getFiles(function(n,i){i&&u(s),t.loadFiles(function(t,n){n&&u(a),e()})})}},{key:"getFileListUrl",value:function(e,t){return"GITHUB"===t.mode?function(e,t){var n=[t.host,"repos",t.username,t.repo,"contents",e+"?ref="+t.branch];return t.prefix&&n.splice(5,0,t.prefix),n.join("/")}(e,t.github):e}},{key:"getFileUrl",value:function(e,t,n){return"GITHUB"===t?e.download_url:"".concat(n,"/").concat(e.getAttribute("href").split("\\").pop().split("/").pop())}},{key:"getFileElements",value:function(e){var t;if("GITHUB"===this.config.mode)t=JSON.parse(e);else{var n=document.createElement("div");n.innerHTML=e,t=[].slice.call(n.getElementsByTagName("a"))}return t}},{key:"getFiles",value:function(e){var t=this;h(this.getFileListUrl(this.type,this.config),function(n,i){i&&e(n,i),t.getFileElements(n).forEach(function(e){var n=t.getFileUrl(e,t.config.mode,t.type);(function(e,t){if(e){var n=e.split(".").pop();return n===t.replace(".","")||"html"===n}})(n,t.config.extension)&&t.files.push(new y(n,t.type,t.layout.single,t.config))}),e(n,i)})}},{key:"loadFiles",value:function(e){var t=this,n=[];this.files.forEach(function(i,r){i.getContent(function(o,s){s&&e(o,s),n.push(r),i.parseContent(),t.files.length==n.length&&e(o,s)})})}},{key:"search",value:function(e,t){this[this.type]=this.files.filter(function(n){return n[e].toLowerCase().trim().indexOf(t.toLowerCase().trim())>=0})}},{key:"resetSearch",value:function(){this[this.type]=this.files}},{key:"getByTag",value:function(e){this[this.type]=this.files.filter(function(t){if(e&&t.tags)return t.tags.some(function(t){return t===e})})}},{key:"getFileByPermalink",value:function(e){return this.files.filter(function(t){return t.permalink===e})[0]}},{key:"render",value:function(){return m(this.layout.list,this.config,this)}}])}(),k=function(){return t(function t(n,i){e(this,t),this.ready=!1,this.collections={},this.filteredCollections={},this.state,this.view=n,this.config=Object.assign({},r,i),this.init()},[{key:"init",value:function(){var e,t=this;this.config.debug&&(e=this.config.messageClassName,(i=document.createElement("div")).className=e,i.innerHTML="DEBUG",i.style.background="yellow",i.style.position="absolute",i.style.top="0px",document.body.appendChild(i)),this.config.elementId?(this.config.container=document.getElementById(this.config.elementId),this.config.container?this.initFileCollections(function(){t.view.addEventListener("hashchange",t.route.bind(t),!1),t.view.dispatchEvent(new HashChangeEvent("hashchange")),t.ready=!0,t.registerPlugins(),t.config.onload()}):u(this.config.debug,o)):u(this.config.debug,o)}},{key:"initFileCollections",value:function(e){var t=this,n=[],i=[];this.config.types.forEach(function(e){t.collections[e.name]=new v(e.name,e.layout,t.config),i.push(e.name)}),i.forEach(function(r,o){t.collections[r].init(function(){n.push(o),0===r.indexOf("post")&&t.collections[r][r].reverse(),i.length==n.length&&e()})})}},{key:"route",value:function(){var e=window.location.hash.split("/").map(function(e){return e.indexOf("?")>=0&&(e=e.substring(0,e.indexOf("?"))),e}).filter(function(e){return"#"!==e}),t=e[0],n=e[1],i=this.collections[t],r=f("query")||"",o=f("tag")||"";if(this.state=window.location.hash.substr(1),t)if(n){var s=["#",t,n.trim()].join("/");i.getFileByPermalink(s).render()}else i?(r?i.search("title",r):o?i.getByTag(o):i.resetSearch(),i.render()):m(this.config.errorLayout,this.config,{});else window.location=["#",this.config.defaultView].join("/");this.config.onroute()}},{key:"registerPlugins",value:function(){var e=this;this.config.plugins.forEach(function(t){var n,i=(n=(n=t.toString()).substr(9)).substr(0,n.indexOf("("));e[i]||(e[i]=t)})}},{key:"sort",value:function(e,t){this.ready?(this.collections[e][e].sort(t),this.collections[e].render()):u(c)}},{key:"search",value:function(e,t,n){this.ready?(this.collections[e].search(t,n),this.collections[e].render()):u(c)}}])}();return function(e){return new k(window,e)}}();
